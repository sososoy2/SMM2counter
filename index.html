<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="./img/icon.png">
  <title>SMM2 Counter! / みんなでバトル用カウンター</title>

  <meta name="description" content="
スーパーマリオメーカー2（SMM2）の「みんなでバトル」用カウンター。
試合数・勝利数・勝率をリアルタイムで管理でき、配信や対戦の記録に最適な無料ツール。
">
  <meta name="keywords" content="SMM2,スーパーマリオメーカー2,マリオメーカー2,Super Mario Maker 2,みんなでバトル,みんバト,勝率 カウンター">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "SMM2 Counter",
  "url": "https://sososoy2.github.io/SMM2counter/",
  "applicationCategory": "GameApplication",
  "description": "SMM2 みんなでバトル用カウンター",
  "operatingSystem": "All",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "JPY"
  }
}
</script>

<style>
@font-face {
  font-family: "smm";
  src: url("./fonts/smm.ttf");
}

body {
  margin: 0;
  background: #ffd700;
  font-family: sans-serif;
}

.container {
  padding-top: 80px;
  text-align: center;
}

.title {
  font-size: 1.4em;
  font-weight: bold;
  font-family: smm;
  letter-spacing: -4px;
  margin-bottom: 40px;
}

.red { color: #dd0000; }

.counter-row {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  padding: 0 60px;
}

.counter {
  background: #fff;
  border-radius: 18px;
  padding: 28px;
  margin-bottom: 28px;
  width: 46%;
  box-shadow: 0 6px 14px rgba(0,0,0,0.3);
  box-sizing: border-box;
}

.label {
  font-size: 22px;
  color: #666;
}

.label input {
  font-size: 22px;
  width: 100%;
  text-align: center;
}

.count {
  font-size: 36px;
  margin: 14px 0;
  font-family: smm;
}

.buttons {
  display: flex;
}

button {
  flex: 1;
  margin: 6px;
  padding: 16px;
  font-size: 24px;
  border: none;
  border-radius: 12px;
  background: #b45a20;
  color: #fff;
  touch-action: manipulation;
}

button:active {
  transform: scale(0.95);
}

.edit-buttons button {
  font-size: 18px;
  padding: 10px;
  background: #888;
}

.reset {
  background: #666;
  padding: 16px;
  border-radius: 14px;
  font-size: 20px;
  min-width: 160px;
}

.edit-row {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 12px;
}

/* ===== 勝率 ===== */
.winrate {
  font-size: 34px;
  font-weight: bold;
  margin: 30px 0;
}

.winrate span {
  color: #e74c3c;
  font-family: smm;
  font-size: 40px;
}

.font-credit {
  margin-top: 40px;
  padding: 12px 20px 24px;
  font-size: 14px;
  color: #444;
  text-align: center;
}

.font-credit a {
  color: #b45a20;
  font-weight: bold;
  text-decoration: none;
}

.font-credit a:hover {
  text-decoration: underline;
}
</style>
</head>

<body>
<div class="container">
  <div class="title">
    <h1>SMM<span class="red">2</span> Counter!</h1>
  </div>

  <div id="counters" class="counter-row"></div>

  <div class="winrate">
    現在の勝率:
    <span id="winrate">0.00%</span>
  </div>

  <div class="edit-row">
    <button class="reset" onclick="resetCounters()">リセット</button>
    <button class="reset" onclick="toggleEdit()">編集</button>
  </div>

  <div id="editArea"></div>
</div>

<footer class="font-credit">
  <p>
    Font: “Super Mario Maker Extended” by Dale Thiessen.<br>
    Licensed under
    <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">
      CC BY-NC-SA 3.0
    </a>.
    <a href="https://fontstruct.com/fontstructions/show/1184080" target="_blank">
      View on Fontstruct
    </a>
    <br><br>
    ※.woff2から.ttf形式に変換して使用しています。
  </p>
</footer>

<script>
const initialCounters = [
  { name: "試合数", value: 0 },
  { name: "勝ち", value: 0 },
  { name: "本負け", value: 0 },
  { name: "ゴール負け", value: 0 },
  { name: "無効試合", value: 0 },
  { name: "ギブアップ", value: 0 }
];

let counters = JSON.parse(JSON.stringify(initialCounters));
let editMode = false;
let backupCounters = null;

function calculateWinRate() {
  const total = counters.find(c => c.name === "試合数")?.value ?? 0;
  const wins = counters.find(c => c.name === "勝ち")?.value ?? 0;
  const invalid = counters.find(c => c.name === "無効試合")?.value ?? 0;
  if (total - invalid <= 0) return 0;
  return (wins / (total - invalid)) * 100;
}

function render() {
  const container = document.getElementById("counters");
  container.innerHTML = "";

  counters.forEach((c, i) => {
    const div = document.createElement("div");
    div.className = "counter";
    div.innerHTML = `
      <div class="label">
        ${editMode
          ? `<input value="${c.name}" oninput="counters[${i}].name=this.value">`
          : c.name}
      </div>
      <div class="count">${c.value}</div>
      <div class="buttons">
        <button data-i="${i}" data-t="inc">+</button>
        <button data-i="${i}" data-t="dec">-</button>
      </div>
      ${editMode ? `
        <div class="edit-row edit-buttons">
          <button onclick="moveUp(${i})">⬆</button>
          <button onclick="moveDown(${i})">⬇</button>
          <button onclick="removeCounter(${i})">❌</button>
        </div>` : ""}
    `;
    container.appendChild(div);
  });

  document.getElementById("winrate").textContent =
    calculateWinRate().toFixed(2) + "%";

  document.getElementById("editArea").innerHTML = editMode ? `
    <div class="edit-row">
      <button class="reset" onclick="addCounter()">＋ カウンター追加</button>
    </div>
    <div class="edit-row">
      <button class="reset" onclick="saveEdit()">変更を保存</button>
      <button class="reset" onclick="cancelEdit()">キャンセル</button>
      <button class="reset" onclick="resetToInitial()">初期値に戻す</button>
      <span style="color: red;">試合数、勝ち、無効試合のいずれかの項目を編集(名前を変更、削除)をすると、勝率が正常に機能しなくなります。</span>
    </div>
  ` : "";
}

document.getElementById("counters").addEventListener("pointerdown", e => {
  const btn = e.target.closest("button");
  if (!btn || editMode) return;
  const i = Number(btn.dataset.i);
  if (btn.dataset.t === "inc") counters[i].value++;
  if (btn.dataset.t === "dec" && counters[i].value > 0) counters[i].value--;
  render();
});

function toggleEdit() {
  backupCounters = JSON.parse(JSON.stringify(counters));
  editMode = true;
  render();
}

function saveEdit() {
  editMode = false;
  backupCounters = null;
  render();
}

function cancelEdit() {
  counters = JSON.parse(JSON.stringify(backupCounters));
  editMode = false;
  render();
}

function resetCounters() {
  counters.forEach(c => c.value = 0);
  render();
}

function resetToInitial() {
  if (!confirm("初期状態に戻しますか？")) return;
  counters = JSON.parse(JSON.stringify(initialCounters));
  editMode = false;
  render();
}

function addCounter() {
  counters.push({ name: "新しいカウンター", value: 0 });
  render();
}

function removeCounter(i) {
  counters.splice(i, 1);
  render();
}

function moveUp(i) {
  if (i === 0) return;
  [counters[i - 1], counters[i]] = [counters[i], counters[i - 1]];
  render();
}

function moveDown(i) {
  if (i === counters.length - 1) return;
  [counters[i + 1], counters[i]] = [counters[i], counters[i + 1]];
  render();
}

render();
</script>
</body>
</html>
